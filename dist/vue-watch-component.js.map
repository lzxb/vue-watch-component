{"version":3,"file":"vue-watch-component.js","sources":["../src/index.js"],"sourcesContent":["class VueWatchComponent {\n  constructor () {\n    this.watches = []\n    this.components = []\n    this.componentsSubs = []\n  }\n  add (watch) {\n    this.watches.push(watch)\n  }\n  init (vm) {\n    const componentsSubs = this.watches.map(watchOption => {\n      return vm.$watch(() => {\n        return watchOption.watch.call(vm)\n      }, (newVal, oldVal) => {\n        if (newVal === watchOption.value) return\n        if (Object.prototype.hasOwnProperty.call(watchOption, 'value')) {\n          watchOption.handler.call(vm, newVal, oldVal)\n        }\n        watchOption.value = newVal\n      }, {\n        immediate: true\n      })\n    })\n    this.components.push(vm)\n    this.componentsSubs.push(componentsSubs)\n  }\n  destroy (vm) {\n    const index = this.components.indexOf(vm)\n    if (index === -1) return\n    this.components.splice(index, 1)\n    const componentsSubs = this.componentsSubs.splice(index, 1)\n    componentsSubs.forEach(componentsSub => {\n      componentsSub.forEach(unwatch => unwatch())\n    })\n  }\n}\n\nconst toBe = (vm, callback) => {\n  const { watchComponents } = vm.$options\n  if (!Array.isArray(watchComponents)) return\n  watchComponents.forEach(watchComponent => {\n    callback(watchComponent)\n  })\n}\n\nVueWatchComponent.install = function (Vue) {\n  Vue.mixin({\n    created () {\n      toBe(this, watchComponent => watchComponent.init(this))\n    },\n    activated () {\n      toBe(this, watchComponent => watchComponent.init(this))\n    },\n    deactivated () {\n      toBe(this, watchComponent => watchComponent.destroy(this))\n    },\n    beforeDestroy () {\n      toBe(this, watchComponent => watchComponent.destroy(this))\n    }\n  })\n}\nif (typeof window === 'object' && window.Vue) {\n  window.Vue.use(VueWatchComponent)\n}\nexport default VueWatchComponent\n"],"names":["VueWatchComponent","watches","components","componentsSubs","watch","push","vm","map","$watch","watchOption","call","newVal","oldVal","value","Object","prototype","hasOwnProperty","handler","index","indexOf","splice","forEach","unwatch","toBe","callback","watchComponents","$options","Array","isArray","watchComponent","install","Vue","mixin","init","destroy","window","use"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAAMA;+BACW;;;SACRC,OAAL,GAAe,EAAf;SACKC,UAAL,GAAkB,EAAlB;SACKC,cAAL,GAAsB,EAAtB;;;;;wBAEGC,OAAO;WACLH,OAAL,CAAaI,IAAb,CAAkBD,KAAlB;;;;yBAEIE,IAAI;UACFH,iBAAiB,KAAKF,OAAL,CAAaM,GAAb,CAAiB,uBAAe;eAC9CD,GAAGE,MAAH,CAAU,YAAM;iBACdC,YAAYL,KAAZ,CAAkBM,IAAlB,CAAuBJ,EAAvB,CAAP;SADK,EAEJ,UAACK,MAAD,EAASC,MAAT,EAAoB;cACjBD,WAAWF,YAAYI,KAA3B,EAAkC;cAC9BC,OAAOC,SAAP,CAAiBC,cAAjB,CAAgCN,IAAhC,CAAqCD,WAArC,EAAkD,OAAlD,CAAJ,EAAgE;wBAClDQ,OAAZ,CAAoBP,IAApB,CAAyBJ,EAAzB,EAA6BK,MAA7B,EAAqCC,MAArC;;sBAEUC,KAAZ,GAAoBF,MAApB;SAPK,EAQJ;qBACU;SATN,CAAP;OADqB,CAAvB;WAaKT,UAAL,CAAgBG,IAAhB,CAAqBC,EAArB;WACKH,cAAL,CAAoBE,IAApB,CAAyBF,cAAzB;;;;4BAEOG,IAAI;UACLY,QAAQ,KAAKhB,UAAL,CAAgBiB,OAAhB,CAAwBb,EAAxB,CAAd;UACIY,UAAU,CAAC,CAAf,EAAkB;WACbhB,UAAL,CAAgBkB,MAAhB,CAAuBF,KAAvB,EAA8B,CAA9B;UACMf,iBAAiB,KAAKA,cAAL,CAAoBiB,MAApB,CAA2BF,KAA3B,EAAkC,CAAlC,CAAvB;qBACeG,OAAf,CAAuB,yBAAiB;sBACxBA,OAAd,CAAsB;iBAAWC,SAAX;SAAtB;OADF;;;;;;AAMJ,IAAMC,OAAO,SAAPA,IAAO,CAACjB,EAAD,EAAKkB,QAAL,EAAkB;MACrBC,eADqB,GACDnB,GAAGoB,QADF,CACrBD,eADqB;;MAEzB,CAACE,MAAMC,OAAN,CAAcH,eAAd,CAAL,EAAqC;kBACrBJ,OAAhB,CAAwB,0BAAkB;aAC/BQ,cAAT;GADF;CAHF;;AAQA7B,kBAAkB8B,OAAlB,GAA4B,UAAUC,GAAV,EAAe;MACrCC,KAAJ,CAAU;WAAA,qBACG;;;WACJ,IAAL,EAAW;eAAkBH,eAAeI,IAAf,OAAlB;OAAX;KAFM;aAAA,uBAIK;;;WACN,IAAL,EAAW;eAAkBJ,eAAeI,IAAf,QAAlB;OAAX;KALM;eAAA,yBAOO;;;WACR,IAAL,EAAW;eAAkBJ,eAAeK,OAAf,QAAlB;OAAX;KARM;iBAAA,2BAUS;;;WACV,IAAL,EAAW;eAAkBL,eAAeK,OAAf,QAAlB;OAAX;;GAXJ;CADF;AAgBA,IAAI,QAAOC,MAAP,yCAAOA,MAAP,OAAkB,QAAlB,IAA8BA,OAAOJ,GAAzC,EAA8C;SACrCA,GAAP,CAAWK,GAAX,CAAepC,iBAAf;CAEF;;;;"}