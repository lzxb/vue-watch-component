{"version":3,"file":"vue-watch-component.min.js","sources":["../src/index.js"],"sourcesContent":["function isArray (arg) {\n  return Object.prototype.toString.call(arg) === '[object Array]';\n}\nfunction has (obj, key) {\n  return Object.prototype.hasOwnProperty.call(obj, key)\n}\nclass VueWatchComponent {\n  constructor () {\n    this.watches = []\n    this.components = []\n    this.componentsSubs = []\n  }\n  add (watch) {\n    this.watches.push(watch)\n  }\n  init (vm) {\n    const componentsSubs = this.watches.map(watchOption => {\n      const options = {\n        immediate: true\n      }\n      if (has(watchOption, 'deep')) {\n        options.deep = watchOption.deep\n      }\n      let isBtn = true\n      return vm.$watch(() => {\n        return watchOption.watch.call(vm)\n      }, (newVal, oldVal) => {\n        if (isBtn && watchOption.immediate !== true) {\n          isBtn = false\n          if (watchOption.value == newVal) {\n            return\n          }\n        }\n        if (typeof watchOption.handler === 'function' && (has(watchOption, 'value') || watchOption.immediate === true)) {\n          watchOption.handler.call(vm, newVal, oldVal)\n        }\n        watchOption.value = newVal\n      }, options)\n    })\n    this.components.push(vm)\n    this.componentsSubs.push(componentsSubs)\n  }\n  destroy (vm) {\n    const index = this.components.indexOf(vm)\n    if (index === -1) return\n    this.components.splice(index, 1)\n    const componentsSubs = this.componentsSubs.splice(index, 1)\n    componentsSubs.forEach(componentsSub => {\n      componentsSub.forEach(unwatch => unwatch())\n    })\n  }\n}\n\nconst toBe = (vm, callback) => {\n  const { watchComponents } = vm.$options\n  if (!isArray(watchComponents)) return\n  watchComponents.forEach(watchComponent => {\n    callback(watchComponent)\n  })\n}\n\nVueWatchComponent.install = function (Vue) {\n  Vue.mixin({\n    created () {\n      toBe(this, watchComponent => watchComponent.init(this))\n    },\n    activated () {\n      toBe(this, watchComponent => watchComponent.init(this))\n    },\n    deactivated () {\n      toBe(this, watchComponent => watchComponent.destroy(this))\n    },\n    beforeDestroy () {\n      toBe(this, watchComponent => watchComponent.destroy(this))\n    }\n  })\n}\n\nVueWatchComponent.version = '__version__'\n\nif (typeof window === 'object' && window.Vue) {\n  window.Vue.use(VueWatchComponent)\n}\nexport default VueWatchComponent\n"],"names":["has","obj","key","Object","prototype","hasOwnProperty","call","VueWatchComponent","watches","components","componentsSubs","watch","push","vm","this","map","options","watchOption","deep","isBtn","$watch","newVal","oldVal","immediate","value","handler","index","indexOf","splice","forEach","unwatch","toBe","callback","arg","watchComponents","$options","toString","watchComponent","install","Vue","mixin","init","destroy","version","window","use"],"mappings":"iuBAGA,SAASA,EAAKC,EAAKC,UACVC,OAAOC,UAAUC,eAAeC,KAAKL,EAAKC,OAE7CK,yCAEGC,gBACAC,mBACAC,wDAEFC,QACEH,QAAQI,KAAKD,gCAEdE,OACEH,EAAiBI,KAAKN,QAAQO,IAAI,gBAChCC,cACO,GAEThB,EAAIiB,EAAa,YACXC,KAAOD,EAAYC,UAEzBC,GAAQ,SACLN,EAAGO,OAAO,kBACRH,EAAYN,MAAML,KAAKO,IAC7B,SAACQ,EAAQC,GACNH,IAAmC,IAA1BF,EAAYM,eACf,EACJN,EAAYO,OAASH,KAIQ,mBAAxBJ,EAAYQ,UAA2BzB,EAAIiB,EAAa,WAAsC,IAA1BA,EAAYM,aAC7EE,QAAQnB,KAAKO,EAAIQ,EAAQC,KAE3BE,MAAQH,IACnBL,UAEAP,WAAWG,KAAKC,QAChBH,eAAeE,KAAKF,mCAElBG,OACDa,EAAQZ,KAAKL,WAAWkB,QAAQd,IACvB,IAAXa,SACCjB,WAAWmB,OAAOF,EAAO,GACPZ,KAAKJ,eAAekB,OAAOF,EAAO,GAC1CG,QAAQ,cACPA,QAAQ,mBAAWC,kBAKjCC,EAAO,SAAClB,EAAImB,OArDAC,EAsDRC,EAAoBrB,EAAGsB,SAAvBD,iBAtDQD,EAuDHC,EAtDkC,mBAAxC/B,OAAOC,UAAUgC,SAAS9B,KAAK2B,OAuDtBJ,QAAQ,cACbQ,aAIb9B,EAAkB+B,QAAU,SAAUC,KAChCC,uCAEK1B,KAAM,mBAAkBuB,EAAeI,6CAGvC3B,KAAM,mBAAkBuB,EAAeI,+CAGvC3B,KAAM,mBAAkBuB,EAAeK,oDAGvC5B,KAAM,mBAAkBuB,EAAeK,iBAKlDnC,EAAkBoC,QAAU,QAEN,gCAAXC,qBAAAA,UAAuBA,OAAOL,YAChCA,IAAIM,IAAItC"}