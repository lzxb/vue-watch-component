{"version":3,"file":"vue-watch-component.min.js","sources":["../src/index.js"],"sourcesContent":["class VueWatchComponent {\n  constructor () {\n    this.watches = []\n    this.components = []\n    this.componentsSubs = []\n  }\n  add (watch) {\n    this.watches.push(watch)\n  }\n  init (vm) {\n    const componentsSubs = this.watches.map(watchOption => {\n      return vm.$watch(() => {\n        return watchOption.watch.call(vm)\n      }, (newVal, oldVal) => {\n        if (newVal === watchOption.value) return\n        if (Object.prototype.hasOwnProperty.call(watchOption, 'value')) {\n          watchOption.handler.call(vm, newVal, oldVal)\n        }\n        watchOption.value = newVal\n      }, {\n        immediate: true\n      })\n    })\n    this.components.push(vm)\n    this.componentsSubs.push(componentsSubs)\n  }\n  destroy (vm) {\n    const index = this.components.indexOf(vm)\n    if (index === -1) return\n    this.components.splice(index, 1)\n    const componentsSubs = this.componentsSubs.splice(index, 1)\n    componentsSubs.forEach(componentsSub => {\n      componentsSub.forEach(unwatch => unwatch())\n    })\n  }\n}\n\nconst toBe = (vm, callback) => {\n  const { watchComponents } = vm.$options\n  if (!Array.isArray(watchComponents)) return\n  watchComponents.forEach(watchComponent => {\n    callback(watchComponent)\n  })\n}\n\nVueWatchComponent.install = function (Vue) {\n  Vue.mixin({\n    created () {\n      toBe(this, watchComponent => watchComponent.init(this))\n    },\n    activated () {\n      toBe(this, watchComponent => watchComponent.init(this))\n    },\n    deactivated () {\n      toBe(this, watchComponent => watchComponent.destroy(this))\n    },\n    beforeDestroy () {\n      toBe(this, watchComponent => watchComponent.destroy(this))\n    }\n  })\n}\nif (typeof window === 'object' && window.Vue) {\n  window.Vue.use(VueWatchComponent)\n}\nexport default VueWatchComponent\n"],"names":["VueWatchComponent","watches","components","componentsSubs","watch","push","vm","this","map","$watch","watchOption","call","newVal","oldVal","value","Object","prototype","hasOwnProperty","handler","index","indexOf","splice","forEach","unwatch","toBe","callback","watchComponents","$options","Array","isArray","watchComponent","install","Vue","mixin","init","destroy","window","use"],"mappings":"suBAAMA,yCAEGC,gBACAC,mBACAC,wDAEFC,QACEH,QAAQI,KAAKD,gCAEdE,MACEH,GAAiBI,KAAKN,QAAQO,IAAI,kBAC/BF,GAAGG,OAAO,iBACRC,GAAYN,MAAMO,KAAKL,IAC7B,SAACM,EAAQC,GACND,IAAWF,EAAYI,QACvBC,OAAOC,UAAUC,eAAeN,KAAKD,EAAa,YACxCQ,QAAQP,KAAKL,EAAIM,EAAQC,KAE3BC,MAAQF,gBAET,WAGVV,WAAWG,KAAKC,QAChBH,eAAeE,KAAKF,mCAElBG,MACDa,GAAQZ,KAAKL,WAAWkB,QAAQd,OACvB,IAAXa,QACCjB,WAAWmB,OAAOF,EAAO,EACPZ,MAAKJ,eAAekB,OAAOF,EAAO,GAC1CG,QAAQ,cACPA,QAAQ,kBAAWC,mBAKjCC,EAAO,SAAClB,EAAImB,MACRC,GAAoBpB,EAAGqB,SAAvBD,eACHE,OAAMC,QAAQH,MACHJ,QAAQ,cACbQ,YAIb9B,GAAkB+B,QAAU,SAAUC,KAChCC,uCAEK1B,KAAM,kBAAkBuB,GAAeI,6CAGvC3B,KAAM,kBAAkBuB,GAAeI,+CAGvC3B,KAAM,kBAAkBuB,GAAeK,oDAGvC5B,KAAM,kBAAkBuB,GAAeK,iBAI5B,+BAAXC,sBAAAA,UAAuBA,OAAOJ,YAChCA,IAAIK,IAAIrC"}