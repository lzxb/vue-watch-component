{"version":3,"file":"vue-watch-component.min.js","sources":["../src/index.js"],"sourcesContent":["function isArray (arg) {\n  return Object.prototype.toString.call(arg) === '[object Array]';\n}\nfunction has (obj, key) {\n  return Object.prototype.hasOwnProperty.call(obj, key)\n}\nclass VueWatchComponent {\n  constructor () {\n    this.watches = []\n    this.components = []\n    this.componentsSubs = []\n  }\n  add (watch) {\n    this.watches.push(watch)\n    return this\n  }\n  remove (watch) {\n    const index = this.watches.indexOf(watch)\n    if (index > -1) {\n      this.watches.splice(index, 1)\n    }\n    return this\n  }\n  init (vm) {\n    const componentsSubs = this.watches.map(watchOption => {\n      const options = {\n        immediate: true\n      }\n      if (has(watchOption, 'deep')) {\n        options.deep = watchOption.deep\n      }\n      let isBtn = true\n      return vm.$watch(() => {\n        return watchOption.watch.call(vm)\n      }, (newVal, oldVal) => {\n        if (isBtn && watchOption.immediate !== true) {\n          isBtn = false\n          if (watchOption.value == newVal) {\n            return\n          }\n        }\n        if (typeof watchOption.handler === 'function' && (has(watchOption, 'value') || watchOption.immediate === true)) {\n          watchOption.handler.call(vm, newVal, oldVal)\n        }\n        watchOption.value = newVal\n      }, options)\n    })\n    this.components.push(vm)\n    this.componentsSubs.push(componentsSubs)\n  }\n  destroy (vm) {\n    const index = this.components.indexOf(vm)\n    if (index === -1) return\n    this.components.splice(index, 1)\n    const componentsSubs = this.componentsSubs.splice(index, 1)\n    componentsSubs.forEach(componentsSub => {\n      componentsSub.forEach(unwatch => unwatch())\n    })\n  }\n}\n\nconst toBe = (vm, callback) => {\n  const { watchComponents } = vm.$options\n  if (!isArray(watchComponents)) return\n  watchComponents.forEach(watchComponent => {\n    callback(watchComponent)\n  })\n}\n\nVueWatchComponent.install = function (Vue) {\n  Vue.mixin({\n    created () {\n      toBe(this, watchComponent => watchComponent.init(this))\n    },\n    activated () {\n      toBe(this, watchComponent => watchComponent.init(this))\n    },\n    deactivated () {\n      toBe(this, watchComponent => watchComponent.destroy(this))\n    },\n    beforeDestroy () {\n      toBe(this, watchComponent => watchComponent.destroy(this))\n    }\n  })\n}\n\nVueWatchComponent.version = '__version__'\n\nif (typeof window === 'object' && window.Vue) {\n  window.Vue.use(VueWatchComponent)\n}\nexport default VueWatchComponent\n"],"names":["has","obj","key","Object","prototype","hasOwnProperty","call","VueWatchComponent","watches","components","componentsSubs","watch","push","this","index","indexOf","splice","vm","map","options","watchOption","deep","isBtn","$watch","newVal","oldVal","immediate","value","handler","forEach","unwatch","toBe","callback","arg","watchComponents","$options","toString","watchComponent","install","Vue","mixin","init","destroy","version","window","use"],"mappings":"iuBAGA,SAASA,EAAKC,EAAKC,UACVC,OAAOC,UAAUC,eAAeC,KAAKL,EAAKC,OAE7CK,yCAEGC,gBACAC,mBACAC,wDAEFC,eACEH,QAAQI,KAAKD,GACXE,oCAEDF,OACAG,EAAQD,KAAKL,QAAQO,QAAQJ,UAC/BG,GAAS,QACNN,QAAQQ,OAAOF,EAAO,GAEtBD,kCAEHI,OACEP,EAAiBG,KAAKL,QAAQU,IAAI,gBAChCC,cACO,GAETnB,EAAIoB,EAAa,YACXC,KAAOD,EAAYC,UAEzBC,GAAQ,SACLL,EAAGM,OAAO,kBACRH,EAAYT,MAAML,KAAKW,IAC7B,SAACO,EAAQC,GACNH,IAAmC,IAA1BF,EAAYM,eACf,EACJN,EAAYO,OAASH,KAIQ,mBAAxBJ,EAAYQ,UAA2B5B,EAAIoB,EAAa,WAAsC,IAA1BA,EAAYM,aAC7EE,QAAQtB,KAAKW,EAAIO,EAAQC,KAE3BE,MAAQH,IACnBL,UAEAV,WAAWG,KAAKK,QAChBP,eAAeE,KAAKF,mCAElBO,OACDH,EAAQD,KAAKJ,WAAWM,QAAQE,IACvB,IAAXH,SACCL,WAAWO,OAAOF,EAAO,GACPD,KAAKH,eAAeM,OAAOF,EAAO,GAC1Ce,QAAQ,cACPA,QAAQ,mBAAWC,kBAKjCC,EAAO,SAACd,EAAIe,OA7DAC,EA8DRC,EAAoBjB,EAAGkB,SAAvBD,iBA9DQD,EA+DHC,EA9DkC,mBAAxC/B,OAAOC,UAAUgC,SAAS9B,KAAK2B,OA+DtBJ,QAAQ,cACbQ,aAIb9B,EAAkB+B,QAAU,SAAUC,KAChCC,uCAEK3B,KAAM,mBAAkBwB,EAAeI,6CAGvC5B,KAAM,mBAAkBwB,EAAeI,+CAGvC5B,KAAM,mBAAkBwB,EAAeK,oDAGvC7B,KAAM,mBAAkBwB,EAAeK,iBAKlDnC,EAAkBoC,QAAU,QAEN,gCAAXC,qBAAAA,UAAuBA,OAAOL,YAChCA,IAAIM,IAAItC"}