{"version":3,"file":"vue-watch-component.esm.js","sources":["../src/index.js"],"sourcesContent":["function isArray (arg) {\n  return Object.prototype.toString.call(arg) === '[object Array]';\n}\nfunction has (obj, key) {\n  return Object.prototype.hasOwnProperty.call(obj, key)\n}\nclass VueWatchComponent {\n  constructor () {\n    this.watches = []\n    this.components = []\n    this.componentsSubs = []\n  }\n  add (watch) {\n    this.watches.push(watch)\n    return this\n  }\n  init (vm) {\n    const componentsSubs = this.watches.map(watchOption => {\n      const options = {\n        immediate: true\n      }\n      if (has(watchOption, 'deep')) {\n        options.deep = watchOption.deep\n      }\n      let isBtn = true\n      return vm.$watch(() => {\n        return watchOption.watch.call(vm)\n      }, (newVal, oldVal) => {\n        if (isBtn && watchOption.immediate !== true) {\n          isBtn = false\n          if (watchOption.value == newVal) {\n            return\n          }\n        }\n        if (typeof watchOption.handler === 'function' && (has(watchOption, 'value') || watchOption.immediate === true)) {\n          watchOption.handler.call(vm, newVal, oldVal)\n        }\n        watchOption.value = newVal\n      }, options)\n    })\n    this.components.push(vm)\n    this.componentsSubs.push(componentsSubs)\n  }\n  destroy (vm) {\n    const index = this.components.indexOf(vm)\n    if (index === -1) return\n    this.components.splice(index, 1)\n    const componentsSubs = this.componentsSubs.splice(index, 1)\n    componentsSubs.forEach(componentsSub => {\n      componentsSub.forEach(unwatch => unwatch())\n    })\n  }\n}\n\nconst toBe = (vm, callback) => {\n  const { watchComponents } = vm.$options\n  if (!isArray(watchComponents)) return\n  watchComponents.forEach(watchComponent => {\n    callback(watchComponent)\n  })\n}\n\nVueWatchComponent.install = function (Vue) {\n  Vue.mixin({\n    created () {\n      toBe(this, watchComponent => watchComponent.init(this))\n    },\n    activated () {\n      toBe(this, watchComponent => watchComponent.init(this))\n    },\n    deactivated () {\n      toBe(this, watchComponent => watchComponent.destroy(this))\n    },\n    beforeDestroy () {\n      toBe(this, watchComponent => watchComponent.destroy(this))\n    }\n  })\n}\n\nVueWatchComponent.version = '__version__'\n\nif (typeof window === 'object' && window.Vue) {\n  window.Vue.use(VueWatchComponent)\n}\nexport default VueWatchComponent\n"],"names":["isArray","arg","Object","prototype","toString","call","has","obj","key","hasOwnProperty","VueWatchComponent","watches","components","componentsSubs","watch","push","vm","map","options","watchOption","deep","isBtn","$watch","newVal","oldVal","immediate","value","handler","index","indexOf","splice","forEach","unwatch","toBe","callback","watchComponents","$options","watchComponent","install","Vue","mixin","init","destroy","version","window","use"],"mappings":"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"}