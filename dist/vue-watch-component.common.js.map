{"version":3,"file":"vue-watch-component.common.js","sources":["../src/index.js"],"sourcesContent":["const util = {\n  isArray (arg) {\n    return Object.prototype.toString.call(arg) === '[object Array]'\n  },\n  has (obj, key) {\n    return Object.prototype.hasOwnProperty.call(obj, key)\n  }\n}\n\nclass VueWatchComponent {\n  constructor (options) {\n    if (typeof options.watch !== 'function') {\n      throw new Error('[vue-watch-component] options.watch must be a function type')\n    }\n    if (typeof options.handler !== 'function') {\n      throw new Error('[vue-watch-component] options.handler must be a function type')\n    }\n    this.initialOptions = options\n    this.options = { ...options }\n    this.vmArr = []\n    this.unwatchArr = []\n  }\n  clone () {\n    return new VueWatchComponent(this.initialOptions)\n  }\n  init (vm) {\n    const options = this.options\n    const watchOptions = {\n      immediate: true\n    }\n    if (util.has(options, 'deep')) {\n      watchOptions.deep = options.deep\n    }\n    let isBtn = true\n    const unwatch = vm.$watch(() => {\n      return options.watch.call(vm)\n    }, (newVal, oldVal) => {\n      if (isBtn && options.immediate !== true) {\n        isBtn = false\n        if (options.value === newVal) {\n          return\n        }\n      }\n      if ((util.has(options, 'value') || options.immediate === true)) {\n        options.handler.call(vm, newVal, oldVal)\n      }\n      options.value = newVal\n    }, watchOptions)\n    this.vmArr.push(vm)\n    this.unwatchArr.push(unwatch)\n  }\n  destroy (vm) {\n    const index = this.vmArr.indexOf(vm)\n    this.vmArr.splice(index, 1)\n    this.unwatchArr[index]()\n    this.unwatchArr.splice(index, 1)\n  }\n}\n\nconst toBe = (vm, callback) => {\n  const { watchComponents } = vm.$options\n  if (!util.isArray(watchComponents)) return\n  watchComponents.forEach(watchComponent => {\n    callback(watchComponent)\n  })\n}\n\nVueWatchComponent.install = function (Vue) {\n  Vue.mixin({\n    created () {\n      toBe(this, watchComponent => watchComponent.init(this))\n    },\n    activated () {\n      toBe(this, watchComponent => watchComponent.init(this))\n    },\n    deactivated () {\n      toBe(this, watchComponent => watchComponent.destroy(this))\n    },\n    beforeDestroy () {\n      toBe(this, watchComponent => watchComponent.destroy(this))\n    }\n  })\n}\n\nVueWatchComponent.version = '__version__'\n\nif (typeof window === 'object' && window.Vue) {\n  window.Vue.use(VueWatchComponent)\n}\nexport default VueWatchComponent\n"],"names":["util","arg","Object","prototype","toString","call","obj","key","hasOwnProperty","VueWatchComponent","options","watch","Error","handler","initialOptions","vmArr","unwatchArr","vm","watchOptions","has","deep","isBtn","unwatch","$watch","newVal","oldVal","immediate","value","push","index","indexOf","splice","toBe","callback","watchComponents","$options","isArray","forEach","watchComponent","install","Vue","mixin","init","destroy","version","window","use"],"mappings":"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"}